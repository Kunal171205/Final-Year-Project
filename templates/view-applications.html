<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Applications | Industrial Explorer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/view-applications.css') }}">

  
</head>
<body>

<header class="top-header">
  <div class="logo">Industrial Explorer</div>
  <nav>
    {% if session.get('user_type') == 'worker' %}
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('jobportal') }}">Job Portal</a>
      <a href="{{ url_for('workerprofile') }}">Profile</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    {% elif session.get('user_type') == 'company' %}
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('b2bhome') }}">B2B Trade</a>
      <a href="{{ url_for('companyprofile') }}">Profile</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    {% else %}
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('jobportal') }}">Job Portal</a>
      <a href="{{ url_for('b2bhome') }}">B2B Trade</a>
      <a href="{{ url_for('logintype') }}">Login</a>
    {% endif %}
  </nav>
</header>

<div class="container">

  {% if job %}
    <h2>Applications for: {{ job.job_title }}</h2>
    <p class="sub">{{ job.job_location }}</p>
  {% else %}
    <h2>All Applications</h2>
    <p class="sub">Applications for all your posted jobs</p>
  {% endif %}

  {% if applications %}
    {% for app in applications %}
    <div class="app-card">
      <div class="info">
        <h4>{{ app.applicant_name }}</h4>
        <p><strong>Job:</strong> {{ app.job.job_title if app.job else 'N/A' }}</p>
        <p><strong>Skill:</strong> {{ app.applicant_skill }}</p>
        <p><strong>Experience:</strong> {{ app.applicant_experience }}</p>
        <p><strong>Age:</strong> {{ app.applicant_age }} |
           <strong>Gender:</strong> {{ app.applicant_gender }}</p>
        <p><strong>Expected Salary:</strong> {{ app.applicant_expected_salary }}</p>
        <p><strong>Email:</strong> {{ app.applicant_email }}</p>
    
        <p>
          <strong>Status:</strong>
          <span class="status-text {{ app.applicant_status }}">
            {{ app.applicant_status|title }}
          </span>
        </p>
    
        <!-- ‚úÖ CONTACT OPTIONS (ONLY WHEN SELECTED) -->
        {% if app.applicant_status == 'selected' %}
        <div class="contact-box">
          <a href="tel:{{ app.applicant_phone }}" class="contact-btn call">üìû Call</a>
          <a href="mailto:{{ app.applicant_email }}" class="contact-btn email">‚úâÔ∏è Email</a>
          <a href="https://wa.me/91{{ app.applicant_phone }}" target="_blank"
             class="contact-btn whatsapp">üí¨ WhatsApp</a>
        </div>
        {% endif %}
      </div>
    
      <!-- ‚úÖ ACTION BUTTONS (ONLY WHEN PENDING) -->
      <div class="actions"
           {% if app.applicant_status != 'pending' %}style="display:none;"{% endif %}>
        <button class="accept"
                onclick="updateStatus({{ app.application_id }}, 'selected', this)">
          Accept
        </button>
    
        <button class="reject"
                onclick="updateStatus({{ app.application_id }}, 'rejected', this)">
          Reject
        </button>
      </div>
    </div>    
    {% endfor %}
  {% else %}
    <div class="app-card">
      <p>No applications found.</p>
    </div>
  {% endif %}

</div>

<script>
  function updateStatus(appId, status, button) {
    fetch("/company/update-application-status", {
      method: "POST",
      credentials: "same-origin",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        application_id: appId,
        status: status
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        const card = button.closest('.app-card');
        const statusText = card.querySelector('.status-text');
  
        statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        statusText.className = "status-text " + status;
  
        // Disable both buttons
        card.querySelectorAll('.actions button')
            .forEach(btn => btn.disabled = true);
      } else {
        alert(data.message || "Update failed");
      }
    })
    .catch(err => {
      console.error(err);
      alert("Server error");
    });
  }
  </script>
  
</body>
</html>
