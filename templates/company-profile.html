<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Company Dashboard | Industrial Explorer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/company-profile.css') }}">
  <script>
    function enableCompanyEdit() {
      toggleCompanyFields(true);
    }
  
    function cancelCompanyEdit() {
      toggleCompanyFields(false);
    }
  
    function toggleCompanyFields(edit) {
      document.querySelectorAll(".view-field").forEach(el =>
        el.style.display = edit ? "none" : "inline"
      );
      document.querySelectorAll(".edit-field").forEach(el =>
        el.style.display = edit ? "inline-block" : "none"
      );
  
      document.getElementById("editCompanyBtn").style.display = edit ? "none" : "inline-block";
      document.getElementById("saveCompanyBtn").style.display = edit ? "inline-block" : "none";
      document.getElementById("cancelCompanyBtn").style.display = edit ? "inline-block" : "none";
    }
  
    function saveCompanyProfile() {
      fetch("/company/update-profile", {
        method: "POST",
        credentials: "same-origin",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          company_name: document.getElementById("e-company-name").value,
          company_contact: document.getElementById("e-company-contact").value,
          company_website: document.getElementById("e-company-website").value,
          company_address: document.getElementById("e-company-address").value
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById("v-company-name").innerText = data.company_name;
          document.getElementById("v-company-contact").innerText = data.company_contact;
          document.getElementById("v-company-website").innerText = data.company_website || "‚Äî";
          document.getElementById("v-company-address").innerText = data.company_address;
          toggleCompanyFields(false);
        } else {
          alert(data.message || "Update failed");
        }
      });
    }
  </script>
  
</head>
<body>

<!-- HEADER -->
<header class="top-header">
  <div class="logo">Industrial Explorer</div>
  <nav>
    {# If logged in, show Profile + Logout, else show Login #}
        {% if session.get('user_type') == 'worker' %}
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('jobportal') }}">Job Portal</a>
            <a href="{{ url_for('workerprofile') }}">Profile</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        {% elif session.get('user_type') == 'company' %}
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('b2bhome') }}">B2B Trade</a>
            <a href="{{ url_for('companyprofile') }}">Profile</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('jobportal') }}">Job Portal</a>
            <a href="{{ url_for('b2bhome') }}">B2B Trade</a>
            <a href="{{ url_for('logintype') }}">Login</a>
        {% endif %}
            
    
  </nav>
</header>

<!-- PAGE -->
<div class="page-container">

  <!-- COMPANY INFO -->
  <div class="company-card">
    <div class="company-header">
      <div class="avatar">üè≠</div>
    
      <div>
        <!-- VIEW -->
        <h2 class="view-field" id="v-company-name">{{ company.company_name }}</h2>
    
        <!-- EDIT -->
        <input class="edit-field"
               id="e-company-name"
               value="{{ company.company_name }}"
               style="display:none;">
    
        <p>{{ company.company_location }} ‚Ä¢ {{ company.company_category }}</p>
      </div>
    
      <!-- ACTIONS -->
      <div class="company-actions">
        <button id="editCompanyBtn" class="btn black" onclick="enableCompanyEdit()">
          Edit Profile
        </button>
    
        <button id="saveCompanyBtn" class="btn green"
                onclick="saveCompanyProfile()"
                style="display:none;">
          Save
        </button>
    
        <button id="cancelCompanyBtn" class="btn black"
                onclick="cancelCompanyEdit()"
                style="display:none;">
          Cancel
        </button>
      </div>
    </div>
    

    <div class="company-info">
      <div>
        <strong>Contact:</strong>
        <span class="view-field" id="v-company-contact">
          {{ company.company_contact }}
        </span>
        <input class="edit-field"
               id="e-company-contact"
               value="{{ company.company_contact }}"
               style="display:none;">
      </div>
      <div>
        <strong>Website:</strong>
        <span class="view-field" id="v-company-website">
          {{ company.company_website or "‚Äî" }}
        </span>
        <input class="edit-field"
               id="e-company-website"
               value="{{ company.company_website }}"
               style="display:none;">
      </div>
      
      <div>
        <strong>Address:</strong>
        <span class="view-field" id="v-company-address">
          {{ company.company_address }}
        </span>
        <input class="edit-field"
               id="e-company-address"
               value="{{ company.company_address }}"
               style="display:none;">
      </div>
      <div>
        <strong>Company Location:</strong>
        <span class="view-field" id="v-company-location-info">
          {{ company.company_location }}
        </span>
      
        <input class="edit-field"
               id="e-company-location-info"
               value="{{ company.company_location }}"
               style="display:none;">
      </div>      
      <div><strong>Email:</strong> {{ company.email }}</div>
      <div><strong>Total Jobs Posted:</strong> {{ total_jobs_posted }}</div>
      <div><strong>B2B Listings:</strong> {{ total_b2b_listings }}</div> 
    </div>

    <!-- ACTION BUTTONS -->
    <div class="action-buttons">
      <a href="{{ url_for('jobpost') }}" class="btn black">Post Job</a>
      <a href="{{ url_for('application') }}" class="btn green">View Applications</a>
    </div>
  </div>

  <!-- JOB STATUS -->
  <div class="section-card">
    <h3>Job Opportunities</h3>
  
    {% if jobs %}
      {% for job in jobs %}
        <div class="row">
          <div>
            <h4>{{ job.job_title }}</h4>
            <p>
              {{ job.job_location }} ‚Ä¢ {{ job.job_shift }}<br>
              <small>{{ job.job_specific_location }}</small>
            </p>
          </div>
  
          <div class="job-actions">
            <span class="status active">Active</span>
            <a href="{{ url_for('application', job_id=job.job_id) }}"
               class="btn small">
              View Applications
            </a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No jobs posted yet.</p>
    {% endif %}
  </div>
  

  <!-- B2B STATUS -->
  <!-- B2B STATUS -->
<div class="section-card">
  <h3>B2B Sell Listings</h3>

{% if sell_items %}
  {% for item in sell_items %}
  <div class="row">
    <div>
      <h4>SELL ‚Ä¢ {{ item.sell_name }}</h4>
      <p>
        {{ item.sell_quantity }} units ‚Ä¢ {{ item.sell_location }} <br>
        ‚Çπ{{ item.sell_price }}
      </p>
    </div>
    <span class="status {{ item.sell_status }}">
      {{ item.sell_status|title }}
    </span>
  </div>
  {% endfor %}
{% else %}
  <p>No sell trades posted yet.</p>
{% endif %}
</div>

<div class="section-card">
  <h3>B2B Buy Requirements</h3>

  {% if buy_items %}
    {% for item in buy_items %}
    <div class="row">
      <div>
        <h4>BUY ‚Ä¢ {{ item.buy_name }}</h4>
        <p>
          {{ item.buy_quantity }} units ‚Ä¢ {{ item.buy_location }} <br>
          Budget: ‚Çπ{{ item.buy_budget if item.buy_budget else "Negotiable" }}
        </p>
      </div>
      <span class="status {{ item.buy_status }}">
        {{ item.buy_status|title }}
      </span>
    </div>
    {% endfor %}
  {% else %}
    <p>No buy requirements yet.</p>
  {% endif %}
</div>


</div>

</body>
</html>